<!doctypehtml><html lang=zh-TW><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><title>å³æ™‚æŠ•å½±</title><script src=https://unpkg.com/vue@3/dist/vue.global.js></script><script src=https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js></script><script src=https://cdn.tailwindcss.com></script><style>@import url(https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap);html{-webkit-overflow-scrolling:touch}body{font-family:Inter,'Noto Sans TC',sans-serif}video{width:100%;height:auto;display:block}.fade-enter-active,.fade-leave-active{transition:opacity .3s ease}.fade-enter-from,.fade-leave-to{opacity:0}.slide-up-enter-active,.slide-up-leave-active{transition:all .35s cubic-bezier(.16,1,.3,1)}.slide-up-enter-from,.slide-up-leave-to{transform:translateY(20px);opacity:0}</style></head><body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 min-h-screen text-gray-800"><div id=app class="flex flex-col min-h-screen"><header class="text-center py-8 px-4 shrink-0"><h1 class="text-4xl font-bold mb-2">å³æ™‚æŠ•å½±</h1><p class="text-gray-600 text-lg">ä½ è¦çœ‹çš„ï¼Œéƒ½è®“ä½ çœ‹</p></header><main class="max-w-4xl w-full mx-auto px-4 pb-8 flex-grow"><transition name=fade mode=out-in><div v-if="view==='home'"key=home class="bg-white/80 backdrop-blur-xl rounded-2xl p-8 shadow-xl border border-white/30"><h2 class="text-2xl font-semibold mb-6 text-center">è«‹é¸æ“‡ä½¿ç”¨æ¨¡å¼</h2><div class="grid md:grid-cols-2 gap-6"><div @click=startAsCamera class="bg-white p-6 rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 cursor-pointer border-2 border-transparent hover:border-blue-400 hover:-translate-y-1"><div class=text-center><div class="text-6xl mb-4">ğŸ“±</div><h3 class="text-xl font-semibold mb-2">ç•¶ä½œæ”å½±æ©Ÿ</h3><p class="text-gray-600 text-sm">è‡ªå‹•ç”¢ç”Ÿæˆ¿è™Ÿï¼Œä¸¦é–‹å§‹æ‹æ”</p></div></div><div @click=startAsDisplay class="bg-white p-6 rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 cursor-pointer border-2 border-transparent hover:border-indigo-400 hover:-translate-y-1"><div class=text-center><div class="text-6xl mb-4">ğŸ–¥ï¸</div><h3 class="text-xl font-semibold mb-2">ç•¶ä½œé¡¯ç¤ºç«¯</h3><p class="text-gray-600 text-sm">è¼¸å…¥æˆ¿è™Ÿï¼Œæ¥æ”¶ä¸¦é¡¯ç¤ºå½±åƒ</p></div></div></div></div><div v-else-if="view==='displayInput'"key=display-input class="bg-white/80 backdrop-blur-xl rounded-2xl p-8 shadow-xl border border-white/30"><div class="max-w-xs mx-auto"><div class=mb-4><label for=room-input class="block text-sm font-medium text-gray-700 mb-2">è«‹è¼¸å…¥ 4 ä½æ•¸æˆ¿é–“è™Ÿç¢¼</label><input id=room-input v-model=inputRoomId type=text inputmode=numeric pattern=[0-9]* placeholder=1234 maxlength=4 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all text-center text-3xl tracking-[0.2em] font-mono shadow-sm"></div><div class="flex flex-col sm:flex-row-reverse gap-3"><button @click=connectAsDisplay :disabled="!(/^\d{4}$/.test(inputRoomId))||isConnecting":class=primaryBtnClasses class="w-full disabled:opacity-50 disabled:cursor-not-allowed"><span v-if=isConnecting>é€£ç·šä¸­...</span><span v-else>é–‹å§‹æ¥æ”¶</span></button><button @click=goHome :class=secondaryBtnClasses class=w-full>è¿”å›</button></div></div></div><div v-else-if="view==='main'"key=main class=space-y-6><div class="bg-white/80 backdrop-blur-xl rounded-2xl p-4 shadow-xl border border-white/30"><div class="flex flex-wrap items-center justify-between gap-3"><div class="flex items-center gap-3"><span :class=status.indicatorClasses><span :class=status.dotClasses class="w-2.5 h-2.5 rounded-full inline-block mr-2"></span>{{status.text}}</span></div><div class="text-sm text-gray-600 font-mono bg-white/70 px-2 py-1 rounded">æˆ¿è™Ÿï¼š<span class="font-semibold text-indigo-600">{{roomId}}</span></div></div></div><div v-if=isCamera class="bg-white/80 backdrop-blur-xl rounded-2xl p-6 shadow-xl border border-white/30 space-y-4"><div class="p-4 bg-indigo-50 border border-dashed border-indigo-200 rounded-lg text-center"><strong @click=copyShareUrl title="é»æ“Šä»¥è¤‡è£½é€£çµ"class="text-4xl font-mono tracking-widest block my-2 py-2 cursor-pointer transition-all duration-200 rounded-lg hover:bg-indigo-100 active:scale-95">{{roomId}}</strong></div><div class=text-center><button v-if=canShare @click=shareViaWeb :class=secondaryBtnClasses class="inline-flex items-center gap-2 px-4"title=åˆ†äº«>ğŸ”— <span>ä½¿ç”¨ç³»çµ±åˆ†äº«</span></button></div><div v-if=!hasRemoteConnection class="text-center text-gray-500 animate-pulse pt-2">ç­‰å¾…é¡¯ç¤ºç«¯é€£ç·š...</div><div v-else class="text-center text-green-600 font-semibold pt-2">é¡¯ç¤ºç«¯å·²é€£ç·šï¼</div></div><div class="bg-white/80 backdrop-blur-xl rounded-2xl p-4 sm:p-6 shadow-xl border border-white/30"><div v-if="isCamera&&localStream"class="max-w-xl mx-auto"><h3 class="text-xl font-semibold text-center mb-4">ğŸ“¹ æœ¬æ©Ÿé è¦½</h3><div class="rounded-2xl overflow-hidden shadow-lg border-2 border-white bg-gray-900"><video ref=localVideo autoplay muted playsinline></video></div></div><div v-if=isDisplay class=relative><div class="rounded-2xl overflow-hidden shadow-lg border-2 border-white bg-gray-900 min-h-[250px] sm:min-h-[400px] flex items-center justify-center"><video ref=remoteVideo autoplay playsinline :class="{hidden:!hasRemoteStream}"></video><div v-if=!hasRemoteStream class="text-center text-white p-8"><div class="text-6xl mb-4 animate-pulse">ğŸ“º</div><h4 class="text-xl font-semibold">ç­‰å¾…æ”å½±æ©Ÿä¸²æµ...</h4></div></div></div><div class="flex justify-center gap-4 mt-6"><button v-if=isCamera @click=switchCamera :class=secondaryBtnClasses>ğŸ”„ åˆ‡æ›é¡é ­</button><button v-if=isDisplay @click=toggleFullscreen :class=secondaryBtnClasses>ğŸ–¼ï¸ å…¨è¢å¹•</button><button @click=disconnect :class=dangerBtnClasses>ğŸ›‘ çµæŸé€£ç·š</button></div></div></div></transition><div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-11/12 max-w-md z-50 space-y-3"><transition name=slide-up><div v-if=errorMessage class="bg-red-100 border border-red-300 text-red-800 px-4 py-3 rounded-xl shadow-lg flex items-center gap-3"><span class=text-xl>âš ï¸</span><p class=flex-grow>{{errorMessage}}</p><button @click="errorMessage=''"class="text-red-500 text-2xl leading-none">&times;</button></div></transition><transition name=slide-up><div v-if=successMessage class="bg-green-100 border border-green-300 text-green-800 px-4 py-3 rounded-xl shadow-lg flex items-center gap-3"><span class=text-xl>âœ…</span><p class=flex-grow>{{successMessage}}</p><button @click="successMessage=''"class="text-green-500 text-2xl leading-none">&times;</button></div></transition></div></main></div><script>const{createApp:c,ref:a,computed:t,onMounted:o,onUnmounted:e,nextTick:n}=Vue,s="wss://api-project.xinshou.tw";c({setup(){const l=a("home"),i=a(null),d=a(""),r=a(""),u=a(!1),m=a(!1),p=a(!1),f=a(!1),v=a(""),g=a(""),h=a("environment"),b=a(null),y=a(null),_=a(null),C=a(null),S=a(null),w=t(()=>i.value==="camera"),k=t(()=>i.value==="display"),x=t(()=>`${window.location.origin}${window.location.pathname}?room=${d.value}`),V=t(()=>!!navigator.share),M=t(()=>{if(m.value){if(w.value&&!f.value)return{text:"ç­‰å¾…é€£ç·š",dotClasses:"bg-yellow-500 animate-pulse"};if(k.value&&!p.value)return{text:"ç­‰å¾…ä¸²æµ",dotClasses:"bg-yellow-500 animate-pulse"};return{text:"å·²é€£ç·š",dotClasses:"bg-green-500"}}return u.value?{text:"é€£ç·šä¸­...",dotClasses:"bg-blue-500 animate-spin"}:{text:"æœªé€£ç·š",dotClasses:"bg-red-500"}}),A="font-semibold py-2 px-5 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-4",B=t(()=>`${A} bg-gradient-to-r from-blue-500 to-indigo-600 text-white focus:ring-blue-300`),P=t(()=>`${A} bg-white hover:bg-gray-100 text-gray-800 border border-gray-200 focus:ring-gray-200`),U=t(()=>`${A} bg-red-500 hover:bg-red-600 text-white focus:ring-red-300`),D=(t,c="error",o=4e3)=>{("error"===c?v:g).value=t,setTimeout(()=>("error"===c?v:g).value="",o)},L=()=>{_.value&&_.value.getTracks().forEach(t=>t.stop()),y.value&&y.value.destroy(),b.value&&b.value.disconnect(),_.value=y.value=b.value=null,m.value=p.value=f.value=!1},j=()=>{L(),l.value="home",i.value=null,d.value=r.value=""},q=j,I=async()=>{i.value="camera",d.value=Math.floor(1e3+9e3*Math.random()).toString(),l.value="main",await E()},H=()=>{i.value="display",l.value="displayInput"},R=async()=>{4===r.value.length&&(d.value=r.value,l.value="main",await E())},E=async()=>{if(u.value||m.value)return;u.value=!0;try{w.value&&await O(),await T(),b.value.emit("join-room",d.value),m.value=!0}catch(t){D(`é€£ç·šå¤±æ•—: ${t.message}`),j()}finally{u.value=!1}},O=async()=>{try{const t={video:{facingMode:h.value,width:{ideal:1280},height:{ideal:720}},audio:!1};_.value=await navigator.mediaDevices.getUserMedia(t),await n(),C.value&&(C.value.srcObject=_.value)}catch(t){throw console.error("Camera init error:",t),new Error("ç„¡æ³•è¨ªå•æ”å½±æ©Ÿï¼Œè«‹ç¢ºèªå·²æˆæ¬Šã€‚")}},T=()=>new Promise((t,c)=>{b.value=io(s,{reconnectionAttempts:3}),b.value.on("connect",()=>{console.log("Socket connected:",b.value.id),t()}),b.value.on("connect_error",()=>c(new Error("ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨"))),b.value.on("user-joined",t=>{w.value&&W(t.userId)}),b.value.on("offer-received",t=>{k.value&&z(t.signal)}),b.value.on("signal",t=>{y.value&&!y.value.destroyed&&y.value.signal(t.signal)}),b.value.on("user-left",()=>{D("å°æ–¹å·²é›¢ç·š","error"),f.value=!1,p.value=!1,y.value&&(y.value.destroy(),y.value=null)})}),F=c=>{c.on("signal",t=>{b.value.emit("forward-signal",{signal:t})}),c.on("connect",()=>f.value=!0),c.on("stream",t=>{p.value=!0,S.value&&(S.value.srcObject=t)}),c.on("close",()=>f.value=!1),c.on("error",t=>D(`P2Pé€£ç·šéŒ¯èª¤: ${t.message}`))},W=t=>{y.value&&y.value.destroy(),y.value=new SimplePeer({initiator:!0,trickle:!1,stream:_.value}),F(y.value)},z=t=>{y.value&&y.value.destroy(),y.value=new SimplePeer({initiator:!1,trickle:!1}),F(y.value),y.value.signal(t)},N=async()=>{h.value="user"===h.value?"environment":"user";try{await O(),y.value&&y.value._pc&&await y.value._pc.getSenders().find(t=>t.track&&"video"===t.track.kind)?.replaceTrack(_.value.getVideoTracks()[0]),D("é¡é ­åˆ‡æ›æˆåŠŸ","success")}catch(t){D(`åˆ‡æ›é¡é ­å¤±æ•—: ${t.message}`)}},K=()=>{S.value&&(document.fullscreenElement?document.exitFullscreen():S.value.requestFullscreen().catch(t=>D(`ç„¡æ³•é€²å…¥å…¨è¢å¹•: ${t.message}`)))},$=async()=>{try{await navigator.clipboard.writeText(x.value),D("é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿","success")}catch(t){D("è¤‡è£½å¤±æ•—ï¼Œæ‚¨çš„ç€è¦½å™¨å¯èƒ½ä¸æ”¯æ´æ­¤åŠŸèƒ½ã€‚")}},G=()=>navigator.share({title:"æ‰‹æ©Ÿé¡é ­å³æ™‚æŠ•å½±",url:x.value});return o(()=>{const t=new URLSearchParams(window.location.search).get("room");t&&/^\d{4}$/.test(t)&&(r.value=t,H(),R())}),e(()=>L()),{view:l,role:i,isCamera:w,isDisplay:k,roomId:d,inputRoomId:r,isConnecting:u,isConnected:m,hasRemoteStream:p,hasRemoteConnection:f,errorMessage:v,successMessage:g,shareUrl:x,canShare:V,status:M,primaryBtnClasses:B,secondaryBtnClasses:P,dangerBtnClasses:U,localVideo:C,remoteVideo:S,localStream:_,startAsCamera:I,startAsDisplay:H,connectAsDisplay:R,goHome:j,disconnect:q,switchCamera:N,toggleFullscreen:K,copyShareUrl:$,shareViaWeb:G}}}).mount("#app")</script></body></html>